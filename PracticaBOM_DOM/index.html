<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>En busca de los Pokémon perdidos</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <h1>En busca de los Pokémon perdidos</h1>
    <div id="game-board" class="board"></div>
    <button id="extra-turn">Intentar ganar turno extra</button>
    <button id="reset-game">Reiniciar Juego</button>
    <div id="score">
        <p>Jugador: <span id="player-score">0</span></p>
        <p>CPU: <span id="cpu-score">0</span></p>
        <p>Turnos del jugador: <span id="player-turns">0</span></p>
        <p>Turnos de la CPU: <span id="cpu-turns">0</span></p>
    </div>
    <h2>Histórico de jugadores</h2>
    <ul id="history"></ul>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const board = document.getElementById("game-board");
            const extraTurnBtn = document.getElementById("extra-turn");
            const resetGameBtn = document.getElementById("reset-game");
            const playerScoreEl = document.getElementById("player-score");
            const cpuScoreEl = document.getElementById("cpu-score");
            const playerTurnsEl = document.getElementById("player-turns");
            const cpuTurnsEl = document.getElementById("cpu-turns");
            const historyEl = document.getElementById("history");
            
            let boardState = Array(16).fill(null);
            let pokemonPositions = new Set();
            while (pokemonPositions.size < 5) {
                pokemonPositions.add(Math.floor(Math.random() * 16));
            }
            
            let playerScore = 0, cpuScore = 0, playerTurns = 0, cpuTurns = 0;
            let gameOver = false;
            
            function renderBoard() {
                board.innerHTML = "";
                boardState.forEach((state, index) => {
                    const cell = document.createElement("div");
                    cell.dataset.index = index;
                    cell.addEventListener("click", playerTurn);
                    if (state !== null) {
                        cell.textContent = state ? "🐾" : "X";
                        cell.style.backgroundColor = "lightgray";
                    }
                    board.appendChild(cell);
                });
            }
            
            function playerTurn(event) {
                if (gameOver) return;
                const index = event.target.dataset.index;
                if (boardState[index] !== null) return;
                boardState[index] = pokemonPositions.has(parseInt(index));
                playerTurns++;
                playerTurnsEl.textContent = playerTurns;
                checkWin();
                setTimeout(cpuTurn, 500);
                renderBoard();
            }
            
            function cpuTurn() {
                if (gameOver) return;
                let availableCells = boardState.map((val, idx) => val === null ? idx : null).filter(v => v !== null);
                if (availableCells.length === 0) return;
                let index = availableCells[Math.floor(Math.random() * availableCells.length)];
                boardState[index] = pokemonPositions.has(index);
                cpuTurns++;
                cpuTurnsEl.textContent = cpuTurns;
                checkWin();
                renderBoard();
            }
            
            function checkWin() {
                playerScore = boardState.filter(val => val === true).length;
                cpuScore = boardState.filter((val, idx) => val === false && pokemonPositions.has(idx)).length;
                playerScoreEl.textContent = playerScore;
                cpuScoreEl.textContent = cpuScore;
                if (playerScore >= 3) {
                    gameOver = true;
                    let name = prompt("¡Felicidades! Introduce tu nombre:");
                    if (name) historyEl.innerHTML += `<li>${name} → ${playerTurns} tiradas</li>`;
                } else if (cpuScore >= 3) {
                    gameOver = true;
                    historyEl.innerHTML += `<li>CPU → ${cpuTurns} tiradas</li>`;
                }
            }
            
            extraTurnBtn.addEventListener("click", () => {
                if (Math.floor(Math.random() * 6) + 1 === 6) {
                    alert("¡Ganas un turno extra!");
                }
            });
            
            resetGameBtn.addEventListener("click", () => {
                boardState.fill(null);
                pokemonPositions.clear();
                while (pokemonPositions.size < 5) {
                    pokemonPositions.add(Math.floor(Math.random() * 16));
                }
                playerScore = cpuScore = playerTurns = cpuTurns = 0;
                playerScoreEl.textContent = cpuScoreEl.textContent = "0";
                playerTurnsEl.textContent = cpuTurnsEl.textContent = "0";
                gameOver = false;
                renderBoard();
            });
            
            renderBoard();
        });
    </script>
</body>
</html>